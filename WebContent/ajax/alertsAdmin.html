<!DOCTYPE html>
<html>
<head>
<script src="./../plugins/jquery/jquery.min.js" type="text/javascript"></script>
<script src="./../plugins/jquery-ui/jquery-ui.min.js"
	type="text/javascript"></script>
<script
	src="./../plugins/jquery-ui-timepicker-addon/jquery-ui-timepicker-addon.js"></script>
<script src="./i18nInit.js" type="text/javascript"></script>
<script type="text/javascript" src="./../js/AjaxFranceLabs/i18njs.js"></script>
<style src="./../css/style_v2.css" type="text/css"></style>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<script src="./i18nInit.js" type="text/javascript"></script>
	<script type="text/javascript" src="./../js/AjaxFranceLabs/i18njs.js"></script>
	<div class="row">
		<div id="breadcrumb" class="col-xs-12">
			<a href="#" class="show-sidebar"> <i class="fa fa-bars"></i>
			</a>
			<ol class="breadcrumb pull-left">
				<li><a id="topbar1" href="index.html"></a></li>
				<li><a id="topbar2" href="#"></a></li>
				<li><a id="topbar3" href="#"></a></li>
			</ol>
			<div id="social" class="pull-right">
				<a href="#"><i class="fa fa-google-plus"></i></a> <a href="#"><i
					class="fa fa-facebook"></i></a> <a href="#"><i
					class="fa fa-twitter"></i></a> <a href="#"><i
					class="fa fa-linkedin"></i></a> <a href="#"><i
					class="fa fa-youtube"></i></a>
			</div>
		</div>
	</div>
	<div class="box">
		<div class="box-header">
			<div class="box-name">
				<i class="fa fa-calendar-o" id="boxname"></i> <span></span>
			</div>
			<div class="box-icons pull-right">
				<a class="collapse-link"> <i class="fa fa-chevron-up"></i>
				</a> <a class="expand-link"> <i class="fa fa-expand"></i>
				</a>
			</div>
			<div class="no-move"></div>
		</div>
		<div class="box-content">
			<form class="form-horizontal" id="form" role="form">
				<fieldset>
				<legend id="delayLegend"></legend>
				<div class="form-group">
					<label id=HourlyLabel class="col-sm-2 control-label"></label>
					<input type="text" class="col-sm-2" id="HourlyDelay" >
				</div>
				<div class="form-group">
					<label id=DailyLabel class="col-sm-2 control-label"></label>
					<input type="text" class="col-sm-2" id="DailyDelay">
				</div>
				<div class="form-group">
					<label id=WeeklyLabel class="col-sm-2 control-label"></label>
					<input type="text" class="col-sm-2" id="WeeklyDelay">
				</div>
				</fieldset>
				<fieldset>
					<legend id="connLegend"></legend>
					<div class="form-group">
						<label id="HostLabel" class="col-sm-2 control-label"></label>
						<input type="text" id="Host" name="Host" class="col-sm-2" />
					</div>
					<div class="form-group">
						<label id="PortLabel" class="col-sm-2 control-label"></label>
						<input type="text" id="Port" name="Port" class="col-sm-2" />
					</div>
				</fieldset>
				<fieldset>
					<legend id="dbLegend"></legend>
					<div class="form-group">
						<label id="DatabaseLabel" class="col-sm-2 control-label"></label>
						<input type="text" id="Database" name="Database" class="col-sm-2" />
						</div>
						<div class="form-group">
						<label id="CollectionLabel" class="col-sm-2 control-label"></label>
						<input type="text" id="Collection" name="Collection"
							class="col-sm-2" />
					</div>
					</fieldset>
					<div class="form-group">
					<div class="col-sm-2"></div>
						<button type="button" class="btn btn-primary btn-label-left"
							id="paramReg" onclick="javascript : parameters()">
							<span><i class="fa fa-clock-o" id="paramRegtext"></i></span>
						</button>
					</div>
					<div class="form-group">
					<div class="col-sm-2"></div>
					<div class="col-sm-2">
						<div class="toggle-switch toggle-switch-success">
							<label>
								<input type="checkbox" id="on/off" onchange="Javascript : onOff()">
								<div class="toggle-switch-inner"></div>
								<div class="toggle-switch-switch"><i class="fa fa-check"></i></div>
							</label>
						</div>
					</div>
					</div>
			</form>
		</div>
	</div>

</body>
<script type="text/javascript">
	doGet();
	$(document).ready(function() {
		var icons = {
			header : "ui-icon-circle-arrow-e",
			activeHeader : "ui-icon-circle-arrow-s"
		};
		document.getElementById("topbar1").innerHTML = window.i18n.msgStore['home'];
		document.getElementById("topbar2").innerHTML = window.i18n.msgStore['admin'];
		document.getElementById("topbar3").innerHTML = window.i18n.msgStore['alertAdmin'];
		document.getElementById("boxname").innerHTML = "\r"+ window.i18n.msgStore['alertAdmin'];
		document.getElementById("HourlyLabel").innerHTML = window.i18n.msgStore['hourlyDelay'];
		document.getElementById("DailyLabel").innerHTML = window.i18n.msgStore['dailyDelay'];
		document.getElementById("WeeklyLabel").innerHTML = window.i18n.msgStore['weeklyDelay'];
		document.getElementById("HostLabel").innerHTML = window.i18n.msgStore['host'];
		document.getElementById("PortLabel").innerHTML = window.i18n.msgStore['port'];
		document.getElementById("delayLegend").innerHTML = window.i18n.msgStore['alertsDelay'];
		document.getElementById("connLegend").innerHTML = window.i18n.msgStore['connConf'];
		document.getElementById("dbLegend").innerHTML = window.i18n.msgStore['dbConf'];
		document.getElementById("DatabaseLabel").innerHTML = window.i18n.msgStore['database'];
		document.getElementById("CollectionLabel").innerHTML = window.i18n.msgStore['collection'];
		document.getElementById("paramRegtext").innerHTML = window.i18n.msgStore['paramReg'];
		//Creates date pickers et get current dates
		$('#HourlyDelay').datetimepicker({
			dateFormat : 'yy-mm-dd'
		});
		$('#HourlyDelay').datepicker('setDate', new Date());
		$('#DailyDelay').datetimepicker({
			dateFormat : 'yy-mm-dd'
		});
		$('#DailyDelay').datepicker('setDate', new Date());
		$('#WeeklyDelay').datetimepicker({
			dateFormat : 'yy-mm-dd'
		});
		$('#WeeklyDelay').datepicker('setDate', new Date());
		//Remove the div of selection, useful on second load of date pickers
		$("a").click(function(){
			var element = document.getElementById("ui-datepicker-div");
			element.parentNode.removeChild(element);
		 });
		});
	function doGet() {$.ajax({			//Ajax request to the doGet of the AlertsAdmin servlet
					type : "GET",
					url : "./../admin/alertsAdmin",
					//if received a response from the server
					success : function(data, textStatus, jqXHR) {
						//Set the button
						if (data.on === "on") {
							document.getElementById("on/off").checked = true;
						} else {
							document.getElementById("on/off").checked = false;
						}
						//Set the parameter
						document.getElementById("Host").value = data.host;
						document.getElementById("Port").value = data.port;
						document.getElementById("Database").value = data.database;
						document.getElementById("Collection").value = data.collection;

					}
				});
	}	
	function onOff() {
		var data = "on/off=" + document.getElementById("on/off").innerHTML
		$.ajax({ //Ajax request to the doGet of the Alerts servlet
			type : "POST",
			url : "./../admin/alertsAdmin",
			data : data,
			//if received a response from the server
			success : function(data, textStatus, jqXHR) {
				doGet();
			}
		});
	}
	function parameters() {
		var data = "hourlyDelay="
				+ document.getElementById("HourlyDelay").value + "&dailyDelay="
				+ document.getElementById("DailyDelay").value + "&weeklyDelay="
				+ document.getElementById("WeeklyDelay").value + "&host="
				+ document.getElementById("Host").value + "&port="
				+ document.getElementById("Port").value  + "&database="
				+ document.getElementById("Database").value + "&collection="
				+ document.getElementById("Collection").value;
		if (data.indexOf("=&") != -1) {
			alert(window.i18n.msgStore['missingParameter']);
		}
		$.ajax({ //Ajax request to the doGet of the Alerts servlet
			type : "POST",
			url : "./../admin/alertsAdmin",
			data : data,
			//if received a response from the server
			success : function(data, textStatus, jqXHR) {
				doGet();
			},
			error : function(jqXHR, textStatus, errorThrown) {
				console.log("Something really bad happened " + textStatus);
				$("#ajaxResponse").html(jqXHR.responseText);
			},
			//capture the request before it was sent to server
			beforeSend : function(jqXHR, settings) {
				//disable the button until we get the response
				$('#add').attr("disabled", true);
			},
			//this is called after the response or error functions are finsihed
			complete : function(jqXHR, textStatus) {
				//enable the button 
				$('#add').attr("disabled", false);
			}
		});
	}
</script>