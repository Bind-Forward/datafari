<!DOCTYPE html>
<html>
<head>
	<script src="./../plugins/jquery/jquery.min.js" type="text/javascript"></script>
    <script src="./../plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
    <script src="../plugins/CLEditor/jquery.cleditor.js"></script>
<script src="../plugins/CLEditor/jquery.cleditor.min.js"></script>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<!--Start Breadcrumb-->
	<div class="row">
		<div id="breadcrumb" class="col-xs-12">
			<a href="#" class="show-sidebar"> <i class="fa fa-bars"></i>
			</a>
			<ol class="breadcrumb pull-left">
				<li><a id="topbar1" href="index.html"></a></li>
				<li><a id="topbar2" href="#"></a></li>
				<li><a id="topbar3" href="#"></a></li>
			</ol>
			<div id="social" class="pull-right">
				<a href="#"><i class="fa fa-google-plus"></i></a> <a href="#"><i
					class="fa fa-facebook"></i></a> <a href="#"><i
					class="fa fa-twitter"></i></a> <a href="#"><i
					class="fa fa-linkedin"></i></a> <a href="#"><i
					class="fa fa-youtube"></i></a>
			</div>
		</div>
	</div>
	<!--End Breadcrumb-->
	<!-- TODO get the list of language in the list_language.txt  -->
	<div class="box">
		<div class="box-header">
			<div class="box-name">
				<i class="fa fa-table"></i><span></span>
			</div>
			<div class="box-icons">
				<a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
				<a class="expand-link"><i class="fa fa-expand"></i></a>
			</div>
			<div class="no-move"></div>
		</div>
		<div id="modBox" class="box-content no-padding">
			<form>
				<fieldset>
					<legend id="Modify"></legend>
					<div class="col-sm-1"></div>
					<div class="col-sm-2">
						<select id="language" class="form-control"
							onclick="javascript: getFile()">
							<OPTION></OPTION>
							<OPTION>fr</OPTION>
							<OPTION>en</OPTION>
						</select>
					</div>
				</fieldset>
			</form>

			<div id="anotherSection">
				<fieldset>
					<div id="ajaxResponse" style="margin-top: 10px;"></div>
				</fieldset>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	$(document).ready(function() {

		//If the user refresh the page  
		$(window).bind('beforeunload', function(e){  
			  cleanSem();
			   });
		//If the user loads an other page
		$("a").click(function(){
			cleanSem();
			$("#ajaxResponse").empty();
		});
		 document.getElementById("Modify").innerHTML = window.i18n.msgStore['selectLang'];
		 document.getElementById("topbar1").innerHTML = window.i18n.msgStore['home'];
		 document.getElementById("topbar2").innerHTML = window.i18n.msgStore['conf'];
		 document.getElementById("topbar3").innerHTML = window.i18n.msgStore['stopwords'];
	});
function getFile(){
	//clean the response area
	$("#ajaxResponse").empty();
	//get the language
	var language = document.getElementById("language").value;
	//if a language has been selected
	if(language != ""){
    var dataString = "language=" + language;
	$.ajax({									//Ajax request to get the content
		url : './../admin/Stopwords',
		type : 'GET',
		data : dataString,
		success: function( data, textStatus, jqXHR) {
			//If the semaphore was already acquired
			if(data==="File already in use"){
				$("#ajaxResponse").append("<div class=col-xs-5></div>");
				$("#ajaxResponse").append("<h3 class=col-xs-2>"+window.i18n.msgStore['usedFile']+"</h3>");
				$("#ajaxResponse").append("<div class=col-xs-5></div>");
			}
			//Else print the content of the file in a textArea
			else{
				//Prevent the user from selecting an other file until he passed by one of the way to release the semaphore
				$('#language').attr("disabled", true);
				$("#ajaxResponse").append("<legend>"+window.i18n.msgStore['stopwords']+"</legend>");
				$("#ajaxResponse").append("<div class=\"col-sm-1\"</div>");
				$("#ajaxResponse").append("<form class=\"col-sm-11\" id=\"res\">");
				$("#res").append("<div class=\"form-group\" id=\"div1\">");
				$("#div1").append("<fieldset id=\"fields\">");
				$("#fields").append("<textarea id=\"input\" required resizable=\"true\"></textarea>");
				var lines = data.split("\n"),i=0, str="";
				while(i<lines.length){
					if(lines[i]!=""){
					str = str+lines[i]+"<br />";
					}
					i++;
				}
				document.getElementById("input").value = str;
				$("#input").cleditor({
		            width: 500, // width not including margins, borders or padding
		            height: 250, // height not including margins, borders or padding
	                controls: // controls to add to the toolbar
	                    " undo redo | cut copy paste pastetext | print source",
	                useCSS: false, // use CSS to style HTML when possible (not supported in ie) 
	                bodyStyle: // style to assign to document body contained within the editor
	                    "margin:4px; font:10pt Arial,Verdana; cursor:text"
		        });
				$("#fields").append("<input style=\"margin-top : 10px;\" type=\"Submit\" class=\"btn btn-primary btn-label-left\" id=\"submit\"value="+window.i18n.msgStore['confirm']+">");
				$("#div1").append("</fieldset>");
				$("#res").append("</div>");
				$("#ajaxResponse").append("</form>");
				//On submit send the value of the textArea to upload()
				$("#res").submit(function(e){
					upload(document.getElementById("input").value);
				});
			}
		},
       error: function(jqXHR, textStatus, errorThrown){
            console.log("Something really bad happened " + textStatus);
             $("#ajaxResponse").html(jqXHR.responseText);
       }
	});
	}
}
function upload(text){
	//Get the language and the content
	var language = document.getElementById("language").value
	var content = text;
	$.ajax({										//Ajax request to rewrite the file
		url : './Stopwords',
		type : 'POST',
		// Form data
		data : {content: content, language: language},	
		datetype : "text",
		contenttype: "text-plain/utf-8",
		success: function( data, textStatus, jqXHR) {
			$("#ajaxResponse").empty();
			$("#ajaxResponse").append(window.i18n.msgStore['modifDone']);
		},
	 	error: function(jqXHR, textStatus, errorThrown){
         	console.log("Something really bad happened " + textStatus);
         	$("#ajaxResponse").html(jqXHR.responseText);
    	},
    	complete: function(jqXHR, textStatus){
        	//allow the user to select a language
        	$('#language').attr("disabled", false);
    	}
	});
}
function cleanSem() {
	var language = document.getElementById("language").value;
	if(language != "" && document.getElementById("input").value != null){	//If the user was editing a file
    	var dataString = "language=" + language;
    	$.ajax({													//Post request to release the semaphore
    		url : './Stopwords',
    		type : 'POST',
    		data : dataString,
    		async : false
    	});
	}
}
</script>
</html>