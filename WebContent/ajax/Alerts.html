<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<!DOCTYPE html>
<html>
<head>
<script src="./../plugins/jquery/jquery.min.js" type="text/javascript"></script>
<script src="./../plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
<style src="./../css/style_v2.css" type="text/css"></style>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<!--Start Breadcrumb-->
	<div class="row">
		<div id="breadcrumb" class="col-xs-12">
			<a href="#" class="show-sidebar"> <i class="fa fa-bars"></i>
			</a>
			<ol class="breadcrumb pull-left">
				<li><a href="index.html">Home</a></li>
				<li><a href="#">Search engine configuration</a></li>
				<li><a href="#">Alerts</a></li>
			</ol>
			<div id="social" class="pull-right">
				<a href="#"><i class="fa fa-google-plus"></i></a> <a href="#"><i
					class="fa fa-facebook"></i></a> <a href="#"><i
					class="fa fa-twitter"></i></a> <a href="#"><i
					class="fa fa-linkedin"></i></a> <a href="#"><i
					class="fa fa-youtube"></i></a>
			</div>
		</div>
	</div>
	<!--End Breadcrumb-->
		<form id="addAlerts">
			<fieldset>
				<legend> Add a alert</legend>
				<input id="addAlert" type="Submit" value="Add" />
			</fieldset>
		</form>
	<form id="getAlerts">
		<fieldset>
			<legend>Search Alerts by keyword</legend>
			<input id="keyword" type="text" name="keyword" /> 
			<input id="myButton" type="Submit" value="Submit" />
		</fieldset>
	</form>
	<div id="anotherSection">
		<fieldset>
			<legend>Contextual Menu</legend>
			<div id="ajaxResponse" class="form-group" role="form" style="margin-right: 15px;">
		</fieldset>
	</div>
</body>
<script>
var d;
$(document).ready(function() {
    //Stops the submit request
    $("#getAlerts").submit(function(e){
           e.preventDefault();
    });
  	//Stops the submit request
    $("#addAlerts").submit(function(e){
        e.preventDefault();
 	});
    //checks for the button click event
    $("#myButton").click(function(e){
         getTab();          
    });
    //checks for the button click event
    $("#addAlert").click(function(e){
      	addAlerts();        
	});  
});
function getTab(){
	//Cleans the response area
    $("#ajaxResponse").empty();
    //get the keyword of the search field and serialize it
    var keyword = $("input#keyword").val();
    dataString = "keyword=" + keyword;
    $.ajax({			//Ajax request to the doGet of the Alerts servlet
        type: "GET",
        url: "./../admin/Alerts",
        data: dataString,
        //if received a response from the server
        success: function( data, textStatus, jqXHR) {
        		var numb = data.alerts.length;
        		//get the data in a global var so it can be used in edit() or remove() 
        		d=data;									
        		var i = 0;
        		//Append the table to the response area
                 $("#ajaxResponse").append("<table id=\"table\" class=\"table table-striped table-bordered table-hover table-condensed\">");
                 $("#table").append("<thead><tr><th>Id</th><th>Keyword</th><th>Subject</th><th>Core</th><th>Frequency</th></tr></thead><tbody>");
                 while (i<numb){	//While they are still alerts to print
                	 var key = data.alerts[i].keyword;
                	 var doc = data.alerts[i];
                	 //Print the alert with an href of the keyword towards edit()
					 $("#table").append("<tr id=\""+i+"\"><th>"+doc._id+"</th><th><a href=\"javascript: edit("+i+")\">"+key+"</a></th><th>"+doc.subject+"</th><th>"+doc.core+"</th><th>"+doc.frequency+"</th></tr>");
					 //Print a button with an href towards remove()
                	 $("#"+i+"").append("<a href=\"javascript: remove("+i+")\" style=\"color: inherit; text-decoration: inherit;\"><button class=\"fa fa-ban\" ></button></a>");
					 i++;
                 }
				$("#table").append("</tbody></table>");
        },
       
        //If there was no resonse from the server
        error: function(jqXHR, textStatus, errorThrown){
             console.log("Something really bad happened " + textStatus);
              $("#ajaxResponse").html(jqXHR.responseText);
        }
    });      
}
function addAlerts(){
	//Clean the response area
	$("#ajaxResponse").empty();
	//Print the add form in the response area
	$("#ajaxResponse").append("<form id=\"add\" class=\"form-horizontal\" role=\"form\">");
	$("#add").append("<fieldset id=\"fieldsAdd\" >");
	$("#fieldsAdd").append("<div class=\"form-group\" id=\"div1\">");
	$("#div1").append("<label class=\"col-sm-2 control-label\">Keyword</label>");
	$("#div1").append("<input required type=\"text\" id=\"keyword\" name=\"keyword\" placeholder=\"Keyword\" class=col-sm-4 >");
	$("#div1").append("<label class=\"col-sm-2 control-label\">Subject</label>");
	$("#div1").append("<input required type=\"text\" id=\"subject\" name=\"subject\" placeholder=\"Subject\" class=col-sm-4 >");
	$("#fieldsAdd").append("</div>");
	$("#fieldsAdd").append("<div class=\"form-group\" id=\"div2\">");
	$("#div2").append("<label class=\"col-sm-2 control-label\">Core</label>");
	$("#div2").append("<input required type=\"text\" id=\"core\" name=\"core\" placeholder=\"Core\" value=\"FileShare\" class=\"col-sm-4\"/>");
	$("#div2").append("<label class=\"col-sm-2 control-label\">Frequency</label>");
	$("#div2").append("<select required id=\"frequency\" name=\"frequency\" class=\"col-sm-4\">	<OPTION>Hourly</OPTION><OPTION>Daily</OPTION><OPTION>Weekly</OPTION></select> ");
	$("#fieldsAdd").append("</div>");
	$("#fieldsAdd").append("<div class=\"form-group\" id=\"div3\">");
	$("#div3").append("</div>");
	$("#fieldsAdd").append("</div>");
	$("#fieldsAdd").append("<div class=\"form-group\" id=\"div4\">");
	$("#div4").append("<div class=\"col-sm-5\"></div>");
	$("#div4").append("<input type=\"Submit\" id=\"newAlerts\" name=\"AddAlert\" value=\"Add Alert\" class=\"col-sm-2\"/>");
	$("#fieldsAdd").append("</div>");
	$("#add").append("</fieldset>");
	$("#ajaxResponse").append("</form>");
	 //Stops the submit request
	$("#add").submit(function(e){
        e.preventDefault();
 	});
	 //Redefines the submit request
	 $("#add").submit(function(e){		
		 //get the 4 parameters, keyword, subject, core, frequency and serialize them
		 var data = $("#add").serialize();	
	 		$.ajax({ 				//Ajax request to the doPost of the Alerts servlet
	       		type: "POST",
	        	url: "./../admin/Alerts",
	       	 	data: data,
	        	//if received a response from the server
	        	success: function(data, textStatus, jqXHR) {
	        		//Clean the response area
	        		$("#ajaxResponse").empty();
	        		//Print "Success" in the response Area
	    	 		$("#ajaxResponse").append("<div class=col-xs-5></div>");
	    			$("#ajaxResponse").append("<h2 class=col-xs-2>Success</h2>");
	    			$("#ajaxResponse").append("<div class=col-xs-5></div>");
	        	},
	        	error: function(jqXHR, textStatus, errorThrown){
	            	 console.log("Something really bad happened " + textStatus);
	              	$("#ajaxResponse").html(jqXHR.responseText);
	        	},
	        	//capture the request before it was sent to server
	        	beforeSend: function(jqXHR, settings){
	            	//disable the button until we get the response
	            	$('#add').attr("disabled", true);
	        	},
	        	//called after the response or error functions are finsihed
	        	complete: function(jqXHR, textStatus){
	            	//enable the button 
	            	$('#add').attr("disabled", false);
	        	}  
	 		});
	 });
}
function edit(i){
	var data = d;
	//clean the response area
	$("#ajaxResponse").empty();
	//print the edit form in the response area with the current values of the area
	$("#ajaxResponse").append("<form id=\"modify\" class=\"form-horizontal\" role=\"form\">");
	$("#modify").append("<fieldset id=\"fields\" >");
	$("#fields").append("<div class=\"form-group\" id=\"div1\">");
	$("#div1").append("<label class=\"col-sm-2 control-label\">Keyword</label>");
	$("#div1").append("<input required type=\"text\" id=\"keyword\" name=\"keyword\" placeholder=\"Keyword\" value="+data.alerts[i].keyword+" class=col-sm-4 >");
	$("#div1").append("<label class=\"col-sm-2 control-label\">Subject</label>");
	$("#div1").append("<input required type=\"text\" id=\"subject\" name=\"subject\" placeholder=\"Subject\" value="+data.alerts[i].subject+" class=col-sm-4 >");
	$("#fields").append("</div>");
	$("#fields").append("<div class=\"form-group\" id=\"div2\">");
	$("#div2").append("<label class=\"col-sm-2 control-label\">Core</label>");
	$("#div2").append("<input required type=\"text\" id=\"core\" name=\"core\" placeholder=\"Core\" value="+data.alerts[i].core+" class=\"col-sm-4\"/>");
	$("#div2").append("<label class=\"col-sm-2 control-label\">Frequency</label>");
	if(data.alerts[i].frequency=="Weekly"){
		$("#div2").append("<select required id=\"frequency\" name=\"frequency\" class=\"col-sm-4\" >	<OPTION>Hourly</OPTION><OPTION>Daily</OPTION><OPTION selected>Weekly</OPTION></select> ");
	}else if(data.alerts[i].frequency=="Hourly"){
		$("#div2").append("<select required id=\"frequency\" name=\"frequency\" class=\"col-sm-4\" >	<OPTION selected>Hourly</OPTION><OPTION>Daily</OPTION><OPTION>Weekly</OPTION></select> ");
	}else {
		$("#div2").append("<select required id=\"frequency\" name=\"frequency\" class=\"col-sm-4\" >	<OPTION>Hourly</OPTION><OPTION selected>Daily</OPTION><OPTION>Weekly</OPTION></select> ");
	}
	$("#fields").append("</div>");
	$("#fields").append("<div class=\"form-group\" id=\"div3\">");
	$("#div3").append("</div>");
	$("#fields").append("</div>");
	$("#fields").append("<div class=\"form-group\" id=\"div4\">");
	$("#div4").append("<div class=\"col-sm-5\"></div>");
	$("#div4").append("<input type=\"Submit\" id=\"newAlerts\" name=\"AddAlert\" value=\"Edit Alert\" class=\"col-sm-2\"/>");
	$("#fields").append("</div>");
	$("#modify").append("</fieldset>");
	$("#ajaxResponse").append("</form>");
	 //Redefines the submit request
	$("#modify").submit(function(e){
        e.preventDefault();
 	});
	//Redefines the submit request
	 $("#modify").submit(function(e){
		 //Gets the Id of the alert and all the parameters of the form and serialize them 
		 var datastring = "_id="+d.alerts[i]._id+"&"+$("#modify").serialize();
		 $.ajax({			//Ajax request to the doPost of the Alerts servlet
		        type: "POST",
		        url: "./../admin/Alerts",
		        data: datastring,
		        //if received a response from the server
		        success: function(data, textStatus, jqXHR) {
		        	//Clean the responseArea
		        	$("#ajaxResponse").empty();
		        	//Print the alerts with the modifications made 
		        	getTab();
		        },
		        error: function(jqXHR, textStatus, errorThrown){
		             console.log("Something really bad happened " + textStatus);
		              $("#ajaxResponse").html(jqXHR.responseText);
		        },
		       
		        //capture the request before it was sent to server
		        beforeSend: function(jqXHR, settings){
		            //disable the button until we get the response
		            $('#modify').attr("disabled", true);
		        },
		        //called after the response or error functions are finsihed
		        complete: function(jqXHR, textStatus){
		            //enable the button 
		            $('#modify').attr("disabled", false);
		        }  
		 });
		 });
}
function remove(i){
	// get the id of the alert to remove and serialize it
	var id = "_id="+d.alerts[i]._id;
	$.ajax({		//Ajax request to the doPost of the Alerts servlet
        type: "POST",
        url: "./../admin/Alerts",
        data: id,
        //if received a response from the server
        success: function(textStatus, jqXHR) {
        	//Suppress the row of the tab that was show the now removed alert
        	var row = document.getElementById(i);
            row.parentNode.removeChild(row);
        },
        //If there was no resonse from the server
        error: function(jqXHR, textStatus, errorThrown){
             console.log("Something really bad happened " + textStatus);
              $("#ajaxResponse").html(jqXHR.responseText);
        }
	});
}
</script>
</html>
</body>
</html>